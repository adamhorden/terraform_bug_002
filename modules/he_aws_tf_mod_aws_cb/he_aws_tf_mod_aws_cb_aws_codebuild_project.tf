# Copyright (c) 2018 - 2020 Adam Horden <adam.horden@horden.engineering>

# ----------------------------------------------------------------------------------------
# Resource:
# ----------------------------------------------------------------------------------------

# aws_codebuild_project.this

resource aws_codebuild_project this {

  # --------------------------------------------------------------------------------------
  # For:
  # --------------------------------------------------------------------------------------

  for_each = length(
    local.he_aws_tf_mod_aws_cb_aws_cb_prj
  ) > 0 ? local.he_aws_tf_mod_aws_cb_aws_cb_prj : {}

  # --------------------------------------------------------------------------------------
  # Depends:
  # --------------------------------------------------------------------------------------

  depends_on = [
    module.he_aws_tf_mod_amz_s3_bkt_aws_cb,
    module.he_aws_tf_mod_aws_iam_rle_aws_cb,
  ]

  # --------------------------------------------------------------------------------------
  # Provider:
  # --------------------------------------------------------------------------------------

  provider = aws.he_aws_tf_app

  # --------------------------------------------------------------------------------------
  # Arguments:
  # --------------------------------------------------------------------------------------

  badge_enabled  = local.he_aws_tf_mod_aws_cb_aws_cb_prj_badge_enabled
  build_timeout  = local.he_aws_tf_mod_aws_cb_aws_cb_prj_build_timeout
  description    = local.he_aws_tf_mod_aws_cb_aws_cb_prj_description
  encryption_key = local.he_aws_tf_mod_aws_cb_aws_cb_prj_enc_key
  name           = local.he_aws_tf_mod_aws_cb_aws_cb_prj_name
  queued_timeout = local.he_aws_tf_mod_aws_cb_aws_cb_prj_queued_timeout
  service_role   = local.he_aws_tf_mod_aws_cb_aws_cb_prj_srv_rle
  tags           = local.he_aws_tf_mod_aws_cb_aws_cb_prj_tags

  # --------------------------------------------------------------------------------------
  # Dynamic:
  # --------------------------------------------------------------------------------------

  #

  dynamic artifacts {

    # ------------------------------------------------------------------------------------
    # For:
    # ------------------------------------------------------------------------------------

    for_each = [
      for
      aws_codebuild_project_af_val
      in
      local.he_aws_tf_mod_aws_cb_aws_cb_prj_artifacts
      : {

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codebuild_project_af_encryption_disabled = lookup(
          aws_codebuild_project_af_val,
          "aws_codebuild_project_af_encryption_disabled",
          false,
        )

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codebuild_project_af_override_artifact_name = lookup(
          aws_codebuild_project_af_val,
          "aws_codebuild_project_af_override_artifact_name",
          false,
        )

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codebuild_project_af_type = format(
          "%s",
          lookup(
            aws_codebuild_project_af_val,
            "aws_codebuild_project_af_type",
            "",
          ),
        )

      }
    ]

    # ------------------------------------------------------------------------------------
    # Iterator:
    # ------------------------------------------------------------------------------------

    iterator = aws_codebuild_project_af_val

    # ------------------------------------------------------------------------------------
    # Content:
    # ------------------------------------------------------------------------------------

    content {

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      encryption_disabled = format(
        "%s",
        lookup(
          aws_codebuild_project_af_val.value,
          "aws_codebuild_project_af_encryption_disabled",
          "",
        ),
      )

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      override_artifact_name = format(
        "%s",
        lookup(
          aws_codebuild_project_af_val.value,
          "aws_codebuild_project_af_override_artifact_name",
          "",
        ),
      )

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      type = format(
        "%s",
        lookup(
          aws_codebuild_project_af_val.value,
          "aws_codebuild_project_af_type",
          "",
        ),
      )

    }
  }

  # --------------------------------------------------------------------------------------
  # Dynamic:
  # --------------------------------------------------------------------------------------

  #

  dynamic environment {

    # ------------------------------------------------------------------------------------
    # For:
    # ------------------------------------------------------------------------------------

    for_each = [
      for
      aws_codebuild_project_env_val
      in
      local.he_aws_tf_mod_aws_cb_aws_cb_prj_environment
      : {
        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codebuild_project_env_compute_type = format(
          "%s",
          lookup(
            aws_codebuild_project_env_val,
            "aws_codebuild_project_env_compute_type",
            "",
          ),
        )

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codebuild_project_env_image = format(
          "%s",
          lookup(
            aws_codebuild_project_env_val,
            "aws_codebuild_project_env_image",
            "",
          ),
        )

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codebuild_project_env_privileged_mode = format(
          "%s",
          lookup(
            aws_codebuild_project_env_val,
            "aws_codebuild_project_env_privileged_mode",
            "",
          ),
        )

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codebuild_project_env_type = format(
          "%s",
          lookup(
            aws_codebuild_project_env_val,
            "aws_codebuild_project_env_type",
            "",
          ),
        )

      }
    ]

    # ------------------------------------------------------------------------------------
    # Iterator:
    # ------------------------------------------------------------------------------------

    iterator = aws_codebuild_project_env_val

    # ------------------------------------------------------------------------------------
    # Content:
    # ------------------------------------------------------------------------------------

    content {

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      compute_type = format(
        "%s",
        lookup(
          aws_codebuild_project_env_val.value,
          "aws_codebuild_project_env_compute_type",
          "",
        ),
      )

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      image = format(
        "%s",
        lookup(
          aws_codebuild_project_env_val.value,
          "aws_codebuild_project_env_image",
          "",
        ),
      )

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      privileged_mode = format(
        "%s",
        lookup(
          aws_codebuild_project_env_val.value,
          "aws_codebuild_project_env_privileged_mode",
          "",
        ),
      )

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      type = format(
        "%s",
        lookup(
          aws_codebuild_project_env_val.value,
          "aws_codebuild_project_env_type",
          "",
        ),
      )

    }
  }

  # --------------------------------------------------------------------------------------
  # Dynamic:
  # --------------------------------------------------------------------------------------

  #

  dynamic logs_config {

    # ------------------------------------------------------------------------------------
    # For:
    # ------------------------------------------------------------------------------------

    for_each = [
      for
      aws_codebuild_project_logs_cnf_val
      in
      local.he_aws_tf_mod_aws_cb_aws_cb_prj_logs_config
      : {

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codebuild_project_logs_cnf_cw_logs = lookup(
          aws_codebuild_project_logs_cnf_val,
          "aws_codebuild_project_logs_cnf_cw_logs",
          [],
        )

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codebuild_project_logs_cnf_s3_logs = lookup(
          aws_codebuild_project_logs_cnf_val,
          "aws_codebuild_project_logs_cnf_s3_logs",
          [],
        )

      }
    ]

    # ------------------------------------------------------------------------------------
    # Iiterator:
    # ------------------------------------------------------------------------------------

    iterator = aws_codebuild_project_logs_cnf_val

    # ------------------------------------------------------------------------------------
    # Content:
    # ------------------------------------------------------------------------------------

    content {

      # ----------------------------------------------------------------------------------
      # Dynamic:
      # ----------------------------------------------------------------------------------

      #

      dynamic cloudwatch_logs {

        # --------------------------------------------------------------------------------
        # For:
        # --------------------------------------------------------------------------------

        for_each = [
          for
          aws_codebuild_project_logs_cnf_cw_logs_val
          in
          lookup(
            aws_codebuild_project_logs_cnf_val.value,
            "aws_codebuild_project_logs_cnf_cw_logs",
            [],
          )
          : {

            # ----------------------------------------------------------------------------
            #
            # ----------------------------------------------------------------------------

            #

            aws_codebuild_project_logs_cnf_cw_logs_group_name = format(
              "%s",
              lookup(
                aws_codebuild_project_logs_cnf_cw_logs_val,
                "aws_codebuild_project_logs_cnf_cw_logs_group_name",
                "",
              ),
            )

            # ----------------------------------------------------------------------------
            #
            # ----------------------------------------------------------------------------

            #

            aws_codebuild_project_logs_cnf_cw_logs_status = format(
              "%s",
              lookup(
                aws_codebuild_project_logs_cnf_cw_logs_val,
                "aws_codebuild_project_logs_cnf_cw_logs_status",
                "",
              ),
            )

            # ----------------------------------------------------------------------------
            #
            # ----------------------------------------------------------------------------

            #

            aws_codebuild_project_logs_cnf_cw_logs_stream_name = format(
              "%s",
              lookup(
                aws_codebuild_project_logs_cnf_cw_logs_val,
                "aws_codebuild_project_logs_cnf_cw_logs_stream_name",
                "",
              ),
            )

          }
        ]

        # --------------------------------------------------------------------------------
        # Iterator:
        # --------------------------------------------------------------------------------

        iterator = aws_codebuild_project_logs_cnf_cw_logs_val

        # --------------------------------------------------------------------------------
        # Content:
        # --------------------------------------------------------------------------------

        content {

          # ------------------------------------------------------------------------------
          #
          # ------------------------------------------------------------------------------

          #

          group_name = format(
            "%s",
            lookup(
              aws_codebuild_project_logs_cnf_cw_logs_val.value,
              "aws_codebuild_project_logs_cnf_cw_logs_group_name",
              "",
            ),
          )

          # ------------------------------------------------------------------------------
          #
          # ------------------------------------------------------------------------------

          #

          status = format(
            "%s",
            lookup(
              aws_codebuild_project_logs_cnf_cw_logs_val.value,
              "aws_codebuild_project_logs_cnf_cw_logs_status",
              "",
            ),
          )

          # ------------------------------------------------------------------------------
          #
          # ------------------------------------------------------------------------------

          #

          stream_name = format(
            "%s",
            lookup(
              aws_codebuild_project_logs_cnf_cw_logs_val.value,
              "aws_codebuild_project_logs_cnf_cw_logs_stream_name",
              "",
            ),
          )

        }
      }

      # ----------------------------------------------------------------------------------
      # Dynamic:
      # ----------------------------------------------------------------------------------

      #

      dynamic s3_logs {

        # --------------------------------------------------------------------------------
        # For:
        # --------------------------------------------------------------------------------

        for_each = [
          for
          aws_codebuild_project_logs_cnf_s3_logs_val
          in
          lookup(
            aws_codebuild_project_logs_cnf_val.value,
            "aws_codebuild_project_logs_cnf_s3_logs",
            [],
          )
          : {

            # ----------------------------------------------------------------------------
            #
            # ----------------------------------------------------------------------------

            #

            aws_codebuild_project_logs_cnf_s3_logs_location = format(
              "%s",
              lookup(
                aws_codebuild_project_logs_cnf_s3_logs_val,
                "aws_codebuild_project_logs_cnf_s3_logs_location",
                "",
              ),
            )

            # ----------------------------------------------------------------------------
            #
            # ----------------------------------------------------------------------------

            #

            aws_codebuild_project_logs_cnf_s3_logs_status = format(
              "%s",
              lookup(
                aws_codebuild_project_logs_cnf_s3_logs_val,
                "aws_codebuild_project_logs_cnf_s3_logs_status",
                "",
              ),
            )

          }
        ]

        # --------------------------------------------------------------------------------
        # Iterator:
        # --------------------------------------------------------------------------------

        iterator = aws_codebuild_project_logs_cnf_s3_logs_val

        # --------------------------------------------------------------------------------
        # Content:
        # --------------------------------------------------------------------------------

        content {

          # ------------------------------------------------------------------------------
          #
          # ------------------------------------------------------------------------------

          #

          location = format(
            "%s",
            lookup(
              aws_codebuild_project_logs_cnf_s3_logs_val.value,
              "aws_codebuild_project_logs_cnf_s3_logs_location",
              "",
            ),
          )

          # ------------------------------------------------------------------------------
          #
          # ------------------------------------------------------------------------------

          #

          status = format(
            "%s",
            lookup(
              aws_codebuild_project_logs_cnf_s3_logs_val.value,
              "aws_codebuild_project_logs_cnf_s3_logs_status",
              "",
            ),
          )

        }
      }
    }
  }

  # --------------------------------------------------------------------------------------
  # Dynamic:
  # --------------------------------------------------------------------------------------

  #

  dynamic source {

    # ------------------------------------------------------------------------------------
    # For:
    # ------------------------------------------------------------------------------------

    for_each = [
      for
      aws_codebuild_project_src_val
      in
      local.he_aws_tf_mod_aws_cb_aws_cb_prj_source
      : {

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codebuild_project_src_buildspec = format(
          "%s",
          lookup(
            aws_codebuild_project_src_val,
            "aws_codebuild_project_src_buildspec",
            "",
          ),
        )

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codebuild_project_src_type = format(
          "%s",
          lookup(
            aws_codebuild_project_src_val,
            "aws_codebuild_project_src_type",
            "",
          ),
        )

      }
    ]

    # ------------------------------------------------------------------------------------
    # Iterator:
    # ------------------------------------------------------------------------------------

    iterator = aws_codebuild_project_src_val

    # ------------------------------------------------------------------------------------
    # Content:
    # ------------------------------------------------------------------------------------

    content {

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      buildspec = format(
        "%s",
        lookup(
          aws_codebuild_project_src_val.value,
          "aws_codebuild_project_src_buildspec",
          "",
        ),
      )

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      type = format(
        "%s",
        lookup(
          aws_codebuild_project_src_val.value,
          "aws_codebuild_project_src_type",
          "",
        ),
      )

    }
  }

}
