# Copyright (c) 2018 - 2020 Adam Horden <adam.horden@horden.engineering>

# ----------------------------------------------------------------------------------------
# Resource:
# ----------------------------------------------------------------------------------------

# aws_codecommit_trigger.this

resource aws_codecommit_trigger this {

  # --------------------------------------------------------------------------------------
  # For:
  # --------------------------------------------------------------------------------------

  for_each = length(
    local.he_aws_tf_mod_aws_cc_aws_cc_trg
  ) > 0 ? local.he_aws_tf_mod_aws_cc_aws_cc_trg : {}

  # --------------------------------------------------------------------------------------
  # Provider:
  # --------------------------------------------------------------------------------------

  provider = aws.he_aws_tf_app

  # --------------------------------------------------------------------------------------
  # Argument:
  # --------------------------------------------------------------------------------------

  repository_name = format(
    "%s",
    lookup(
      aws_codecommit_repository.this[
        each.key
      ],
      "repository_name",
      "",
    ),
  )

  # --------------------------------------------------------------------------------------
  # Dynamic:
  # --------------------------------------------------------------------------------------

  #

  dynamic trigger {

    # ------------------------------------------------------------------------------------
    # For:
    # ------------------------------------------------------------------------------------

    for_each = [
      for
      aws_codecommit_trigger_trg_val
      in
      local.he_aws_tf_mod_aws_cc_aws_cc_trg_trigger
      : {

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codecommit_trigger_trg_destination_arn = format(
          "%s",
          lookup(
            aws_codecommit_trigger_trg_val,
            "aws_codecommit_trigger_trg_destination_arn",
            "",
          ),
        )

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codecommit_trigger_trg_events = formatlist(
          "%s",
          lookup(
            aws_codecommit_trigger_trg_val,
            "aws_codecommit_trigger_trg_events",
            [],
          ),
        )

        # --------------------------------------------------------------------------------
        #
        # --------------------------------------------------------------------------------

        #

        aws_codecommit_trigger_trg_name = format(
          "%s",
          lookup(
            aws_codecommit_trigger_trg_val,
            "aws_codecommit_trigger_trg_name",
            "",
          ),
        )

      }
    ]

    # ------------------------------------------------------------------------------------
    # Iterator:
    # ------------------------------------------------------------------------------------

    iterator = aws_codecommit_trigger_trg_val

    # ------------------------------------------------------------------------------------
    # Content:
    # ------------------------------------------------------------------------------------

    content {

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      destination_arn = format(
        "%s",
        lookup(
          aws_codecommit_trigger_trg_val.value,
          "aws_codecommit_trigger_trg_destination_arn",
          "",
        ),
      )

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      events = formatlist(
        "%s",
        lookup(
          aws_codecommit_trigger_trg_val.value,
          "aws_codecommit_trigger_trg_events",
          [],
        ),
      )

      # ----------------------------------------------------------------------------------
      #
      # ----------------------------------------------------------------------------------

      #

      name = format(
        "%s",
        lookup(
          aws_codecommit_trigger_trg_val.value,
          "aws_codecommit_trigger_trg_name",
          "",
        ),
      )

    }
  }

}
